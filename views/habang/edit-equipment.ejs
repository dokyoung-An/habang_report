<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/css/main.css" rel="stylesheet" />
    <link href="/css/equipment.css" rel="stylesheet"/>
    <title>ì¥ë¹„ì ê²€ ë³´ê³ ì„œ ìˆ˜ì •</title>
</head>
<body>
    <div class="container mt-4">
        <ul class="nav nav-tabs">
            <a class="nav-link logo-link" href="/">
              <img src="/image/logo_bl.png" alt="ë¡œê³ " class="logo-image" />
            </a>
            <li class="nav-item">
              <a class="nav-link" href="/customer">
                <i class="bi bi-house-door"></i> ê³ ê°ì •ë³´ë“±ë¡
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/customer-list">
                <i class="bi bi-list-check"></i> ë³´ê³ ì„œë¦¬ìŠ¤íŠ¸
              </a>
            </li>
          </ul>
        
    <div class="newcon">
      <h2>ğŸ“ ì¥ë¹„ì ê²€ ë³´ê³ ì„œ ìˆ˜ì •</h2>
        <form action="/update-equipment-report" method="POST">
            <input type="hidden" name="reportId" value="<%= report && report._id ? report._id : '' %>" />


            <!-- âœ… 1. ë¼ëˆ ì ê²€ -->
            <h4>1. ë¼ëˆ ì ê²€ (RADON EYE)</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì •ìƒ</th>
                        <th>ê¸°ì¤€ì¹˜ ì´ˆê³¼</th>
                        <th>Pci/L</th>
                    </tr>
                </thead>
                <tbody>
                    <% ["ì£¼ë°©/ê±°ì‹¤", "ê°€ì¡±ìš•ì‹¤", "ì¹¨ì‹¤1(ì•ˆë°©)"].forEach((item, index) => { %>
                    <tr>
                        <td><%= item %></td>
                        <td><input type="checkbox" name="radon[<%= index %>][status]" <%= report.equipmentInspection.radon[index].status ? "checked" : "" %> /></td>
                        <td><input type="checkbox" name="radon[<%= index %>][exceed]" <%= report.equipmentInspection.radon[index].exceed ? "checked" : "" %> /></td>
                        <td><input type="text" name="radon[<%= index %>][value]" class="form-control" value="<%= report.equipmentInspection.radon[index].value %>" /></td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <!-- âœ… 2. í¬ë¦„ì•Œë°íˆë“œ -->
            <h4>2. í¬ë¦„ì•Œë°íˆë“œ</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì •ìƒ</th>
                        <th>ê¸°ì¤€ì¹˜ ì´ˆê³¼</th>
                        <th>HCHO (ppm)</th>
                    </tr>
                </thead>
                <tbody>
                    <% ["ì£¼ë°©/ê±°ì‹¤", "ê°€ì¡±ìš•ì‹¤", "ì¹¨ì‹¤1(ì•ˆë°©)"].forEach((item, index) => { %>
                    <tr>
                        <td><%= item %></td>
                        <td><input type="checkbox" name="formaldehyde[<%= index %>][status]" <%= report.equipmentInspection.formaldehyde[index].status ? "checked" : "" %> /></td>
                        <td><input type="checkbox" name="formaldehyde[<%= index %>][exceed]" <%= report.equipmentInspection.formaldehyde[index].exceed ? "checked" : "" %> /></td>
                        <td><input type="text" name="formaldehyde[<%= index %>][value]" class="form-control" value="<%= report.equipmentInspection.formaldehyde[index].value %>" /></td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <!-- âœ… 3. ì—´í™˜ìƒì¹´ë©”ë¼ ì ê²€ -->
            <h4>3. ì—´í™”ìƒì¹´ë©”ë¼ ì ê²€</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì •ìƒ</th>
                        <th colspan="4">í•˜ì</th>
                    </tr>
                </thead>
                <tbody>
                    <% ["ì£¼ë°©", "ê±°ì‹¤", "ì¹¨ì‹¤1(ì•ˆë°©)", "ì¹¨ì‹¤2", "ì¹¨ì‹¤3", "ë“œë ˆìŠ¤ë£¸"].forEach((item, index) => { %>
                    <tr>
                        <td><%= item %></td>
                        <td><input type="checkbox" name="equipment[<%= index %>][status]" <%= report.equipmentInspection.thermalCamera[index].status ? "checked" : "" %> /></td>
                        <td><input type="checkbox" name="equipment[<%= index %>][defect]" value="ê³°íŒ¡ì´" <%= report.equipmentInspection.thermalCamera[index].defect?.includes("ê³°íŒ¡ì´") ? "checked" : "" %> /> ê³°íŒ¡ì´</td>
                        <td><input type="checkbox" name="equipment[<%= index %>][defect]" value="ê²°ë¡œ" <%= report.equipmentInspection.thermalCamera[index].defect?.includes("ê²°ë¡œ") ? "checked" : "" %> /> ê²°ë¡œ</td>
                        <td><input type="checkbox" name="equipment[<%= index %>][defect]" value="ë‹¨ì—´ì¬ ëˆ„ë½" <%= report.equipmentInspection.thermalCamera[index].defect?.includes("ë‹¨ì—´ì¬ ëˆ„ë½") ? "checked" : "" %> /> ë‹¨ì—´ì¬ ëˆ„ë½</td>
                        <td><input type="checkbox" name="equipment[<%= index %>][defect]" value="ëˆ„ìˆ˜" <%= report.equipmentInspection.thermalCamera[index].defect?.includes("ëˆ„ìˆ˜") ? "checked" : "" %> /> ëˆ„ìˆ˜</td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <!-- âœ… 4. ë°°ê´€ ìœ¡ì•ˆ ì ê²€ -->
            <h4>4. ë°°ê´€ ìœ¡ì•ˆ ì ê²€</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì •ìƒ</th>
                        <th colspan="4">í•˜ì</th>
                    </tr>
                </thead>
                <tbody>
                    <% ["ê°€ì¡±ìš•ì‹¤", "ë¶€ë¶€ìš•ì‹¤", "ë°œì½”ë‹ˆ", "ë‹¤ìš©ë„ì‹¤"].forEach((item, index) => { %>
                    <tr>
                        <td><%= item %></td>
                        <td><input type="checkbox" name="pipeInspection[<%= index %>][status]" <%= report.equipmentInspection.pipeInspection[index].status ? "checked" : "" %> /></td>
                        <td><input type="checkbox" name="pipeInspection[<%= index %>][defect]" value="íŒŒì†" <%= report.equipmentInspection.pipeInspection[index].defect?.includes("íŒŒì†") ? "checked" : "" %> /> íŒŒì†</td>
                        <td><input type="checkbox" name="pipeInspection[<%= index %>][defect]" value="íŒ¨ìì¬" <%= report.equipmentInspection.pipeInspection[index].defect?.includes("íŒ¨ìì¬") ? "checked" : "" %> /> íŒ¨ìì¬</td>
                        <td><input type="checkbox" name="pipeInspection[<%= index %>][defect]" value="ë°°ê´€ì••í˜" <%= report.equipmentInspection.pipeInspection[index].defect?.includes("ë°°ê´€ì••í˜") ? "checked" : "" %> /> ë°°ê´€ì••í˜</td>
                        <td><input type="checkbox" name="pipeInspection[<%= index %>][defect]" value="ê¸°íƒ€" <%= report.equipmentInspection.pipeInspection[index].defect?.includes("ê¸°íƒ€") ? "checked" : "" %> /> ê¸°íƒ€</td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <!-- âœ… 5. ë°”ë‹¥ ë ˆì´ì € ìˆ˜í‰ -->
            <h4>5. ë°”ë‹¥ ë ˆì´ì € ìˆ˜í‰</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì •ìƒ</th>
                        <th>í•˜ì</th>
                        <th>ì¢Œì¸¡ ë†’ì´ (mm)</th>
                        <th>ìš°ì¸¡ ë†’ì´ (mm)</th>
                        <th>ì°¨ì´</th>
                    </tr>
                </thead>
                <tbody>
                    <% ["ê±°ì‹¤", "ì¹¨ì‹¤1", "ì¹¨ì‹¤2", "ì¹¨ì‹¤3"].forEach((item, index) => { %>
                    <tr>
                        <td><%= item %></td>
                        <td><input type="checkbox" name="floor_level[<%= index %>][normal]" <%= report.equipmentInspection.floorLevel[index].normal ? "checked" : "" %> /></td>
                        <td><input type="checkbox" name="floor_level[<%= index %>][defect]" <%= report.equipmentInspection.floorLevel[index].defect ? "checked" : "" %> /></td>
                        <td><input type="text" name="floor_level[<%= index %>][left]" class="form-control" value="<%= report.equipmentInspection.floorLevel[index].left %>" /></td>
                        <td><input type="text" name="floor_level[<%= index %>][right]" class="form-control" value="<%= report.equipmentInspection.floorLevel[index].right %>" /></td>
                        <td><input type="text" name="floor_level[<%= index %>][difference]" class="form-control" value="<%= report.equipmentInspection.floorLevel[index].difference %>" /></td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>
           <!-- âœ… 6. ìš•ì‹¤ ë° ë°œì½”ë‹ˆ ë°”ë‹¥ íƒ€ì¼ ë°°ìˆ˜ ì—­ë¥˜ ì ê²€ -->
<h4>6. ìš•ì‹¤ ë° ë°œì½”ë‹ˆ ë°”ë‹¥ íƒ€ì¼ ë°°ìˆ˜ ì—­ë¥˜ ì ê²€</h4>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>í•­ëª©</th>
      <th>ì •ìƒ</th>
      <th>í•˜ì</th>
      <th>ì„¸ë¶€ë‚´ìš©</th>
      <th>ë¹„ê³ </th>
    </tr>
  </thead>
  <tbody>
    <% ["ê°€ì¡±ìš•ì‹¤", "ë¶€ë¶€ìš•ì‹¤", "ë°œì½”ë‹ˆ", "ë‹¤ìš©ë„ì‹¤"].forEach((item, index) => { %>
    <tr>
      <!-- âœ… í•­ëª©ëª… -->
      <td><%= item %></td>

      <!-- âœ… ì •ìƒ ì²´í¬ë°•ìŠ¤ -->
      <td>
        <input type="checkbox" name="drain_check[<%= index %>][normal]" 
          <%= report.equipmentInspection?.drainInspection?.[index]?.normal ? "checked" : "" %> />
      </td>

      <!-- âœ… í•˜ì ì²´í¬ë°•ìŠ¤ -->
      <td>
        <input type="checkbox" name="drain_check[<%= index %>][defect]" 
          <%= report.equipmentInspection?.drainInspection?.[index]?.defect ? "checked" : "" %> />
      </td>

      <!-- âœ… ì„¸ë¶€ë‚´ìš© ì…ë ¥ -->
      <td>
        <input type="text" name="drain_check[<%= index %>][detail]" class="form-control" 
          value="<%= report.equipmentInspection?.drainInspection?.[index]?.detail || "" %>" />
      </td>

      <!-- âœ… ë¹„ê³  ì…ë ¥ -->
      <td>
        <input type="text" name="drain_check[<%= index %>][note]" class="form-control" 
          value="<%= report.equipmentInspection?.drainInspection?.[index]?.note || "" %>" />
      </td>
    </tr>
    <% }); %>
  </tbody>
</table>


            <button type="submit" class="btn btn-success">ğŸ“ ìˆ˜ì • ì™„ë£Œ</button>
        </form>
    </div>
</div>

    <script>
       document.querySelector("form").addEventListener("submit", function (e) {
    let reportId = document.querySelector("input[name='reportId']").value;
    if (!reportId || reportId.trim().length !== 24) {
      alert("âŒ ë³´ê³ ì„œ IDê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!");
      e.preventDefault();
    }
  });
    </script>
</body>
</html>
